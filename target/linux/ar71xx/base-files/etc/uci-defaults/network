#!/bin/sh
#
# Copyright (C) 2011 OpenWrt.org
#

set_interface_loopback() {
	uci batch <<EOF
set network.loopback='interface'
set network.loopback.ifname='lo'
set network.loopback.proto='static'
set network.loopback.ipaddr='127.0.0.1'
set network.loopback.netmask='255.0.0.0'
EOF
}

set_interface_lan() {
	local ifname=$1

	uci batch <<EOF
set network.lan='interface'
set network.lan.ifname='$ifname'
set network.lan.type='bridge'
set network.lan.proto='static'
set network.lan.ipaddr='192.168.1.1'
set network.lan.netmask='255.255.255.0'
EOF
}

set_interface_wan() {
	local ifname=$1

	uci batch <<EOF
set network.wan='interface'
set network.wan.ifname='$ifname'
set network.wan.proto='dhcp'
EOF
}

set_interfaces_lan_wan() {
	local lan_ifname=$1
	local wan_ifname=$2

	set_interface_lan "$lan_ifname"
	set_interface_wan "$wan_ifname"
}

[ -e /etc/config/network ] && exit 0

touch /etc/config/network

set_interface_loopback

. /lib/ar71xx.sh

board=$(ar71xx_board_name)

case "$board" in
aw-nr580 |\
bullet-m |\
eap7660d |\
rb-411 |\
tl-wa901nd-v2 |\
tl-wr703n |\
wp543)
	set_interface_lan "eth0"
	;;

*)
	set_interfaces_lan_wan "eth0" "eth1"
	;;
esac

uci commit network

exit 0
