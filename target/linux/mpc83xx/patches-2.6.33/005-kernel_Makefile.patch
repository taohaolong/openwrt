--- a/arch/powerpc/kernel/Makefile	
+++ b/arch/powerpc/kernel/Makefile	
@@ -97,9 +97,11 @@ obj-$(CONFIG_FUNCTION_GRAPH_TRACER)	+= f
 
 obj-$(CONFIG_8XX_MINIMAL_FPEMU) += softemu8xx.o
 
+ifneq ($(CONFIG_RB_IOMAP),y)
 ifneq ($(CONFIG_PPC_INDIRECT_IO),y)
 obj-y				+= iomap.o
 endif
+endif
 
 obj-$(CONFIG_PPC64)		+= $(obj64-y)
 
