Index: linux-2.6.34/arch/mips/kernel/traps.c
===================================================================
--- linux-2.6.34.orig/arch/mips/kernel/traps.c	2010-05-17 01:17:36.000000000 +0400
+++ linux-2.6.34/arch/mips/kernel/traps.c	2010-05-22 14:22:35.000000000 +0400
@@ -51,6 +51,7 @@
 #include <asm/stacktrace.h>
 #include <asm/irq.h>
 #include <asm/uasm.h>
+#include <asm/time.h>
 
 extern void check_wait(void);
 extern asmlinkage void r4k_wait(void);
@@ -1506,6 +1507,8 @@
 	if (cpu_has_mips_r2) {
 		cp0_compare_irq_shift = CAUSEB_TI - CAUSEB_IP;
 		cp0_compare_irq = (read_c0_intctl() >> INTCTLB_IPTI) & 7;
+		if (get_c0_compare_irq)
+			cp0_compare_irq = get_c0_compare_irq();
 		cp0_perfcount_irq = (read_c0_intctl() >> INTCTLB_IPPCI) & 7;
 		if (cp0_perfcount_irq == cp0_compare_irq)
 			cp0_perfcount_irq = -1;
Index: linux-2.6.34/arch/mips/include/asm/time.h
===================================================================
--- linux-2.6.34.orig/arch/mips/include/asm/time.h	2010-05-17 01:17:36.000000000 +0400
+++ linux-2.6.34/arch/mips/include/asm/time.h	2010-05-21 11:32:22.000000000 +0400
@@ -52,6 +52,7 @@
  */
 #ifdef CONFIG_CEVT_R4K_LIB
 extern unsigned int __weak get_c0_compare_int(void);
+extern unsigned int __weak get_c0_compare_irq(void);
 extern int r4k_clockevent_init(void);
 #endif
 
