#!/bin/sh
#
# Copyright (C) 2012 OpenWrt.org
#

COMMIT_SYSTEM=0

set_led_usbdev() {
	local cfg="led_$1"
	local name=$2
	local sysfs=$3
	local dev=$4

	uci -q get system.$cfg && return 0

	uci batch <<EOF
set system.$cfg='led'
set system.$cfg.name='$name'
set system.$cfg.sysfs='$sysfs'
set system.$cfg.trigger='usbdev'
set system.$cfg.dev='$dev'
set system.$cfg.interval='50'
EOF
	COMMIT_SYSTEM=1
}

. /lib/mcs814x.sh

board=$(mcs814x_board_name)

case "$board" in
dlan-usb-extender)
	set_led_usbdev "usb" "USB" "dlan-usb-extender:green:usb" "1-1"
	;;
rbt-832)
	set_led_usbdev "usb" "USB" "rbt-832:red:usb0" "1-1"
	set_led_usbdev "usb" "USB" "rbt-832:red:usb1" "1-2"
	set_led_usbdev "usb" "USB" "rbt-832:red:usb2" "1-3"
	set_led_usbdev "usb" "USB" "rbt-832:red:usb3" "1-4"
	;;
esac

[ "$COMMIT_SYSTEM" == "1" ] && uci commit system

exit 0
