From 14f870b27b836acee5f04809287175016ca16b05 Mon Sep 17 00:00:00 2001
From: Ivo van Doorn <IvDoorn@gmail.com>
Date: Sun, 15 Mar 2009 15:13:58 +0100
Subject: [PATCH] rt2x00: Fix module loading in case of error (rt2800pci)

Signed-off-by: Ivo van Doorn <IvDoorn@gmail.com>
---
 drivers/net/wireless/rt2x00/rt2800pci.c |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

--- a/drivers/net/wireless/rt2x00/rt2800pci.c
+++ b/drivers/net/wireless/rt2x00/rt2800pci.c
@@ -3014,10 +3014,19 @@ static int __init rt2800pci_init(void)
 
 #ifdef CONFIG_RT2800PCI_WISOC
 	ret = platform_driver_register(&rt2800soc_driver);
+	if (ret)
+		return ret;
 #endif
 #ifdef CONFIG_RT2800PCI_PCI
 	ret = pci_register_driver(&rt2800pci_driver);
+	if (ret) {
+#ifdef CONFIG_RT2800PCI_WISOC
+		platform_driver_unregister(&rt2800soc_driver);
+#endif
+		return ret;
+	}
 #endif
+
 	return ret;
 }
 
