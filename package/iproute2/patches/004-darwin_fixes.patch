Index: iproute2-2.6.15-060110/netem/maketable.c
===================================================================
--- iproute2-2.6.15-060110.orig/netem/maketable.c	2007-06-04 13:22:33.339786864 +0200
+++ iproute2-2.6.15-060110/netem/maketable.c	2007-06-04 13:22:34.476614040 +0200
@@ -10,7 +10,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <math.h>
+#ifndef __APPLE__
 #include <malloc.h>
+#endif
 #include <string.h>
 #include <sys/types.h>
 #include <sys/stat.h>
Index: iproute2-2.6.15-060110/netem/normal.c
===================================================================
--- iproute2-2.6.15-060110.orig/netem/normal.c	2007-06-04 13:22:33.344786104 +0200
+++ iproute2-2.6.15-060110/netem/normal.c	2007-06-04 13:22:34.476614040 +0200
@@ -8,8 +8,12 @@
 #include <string.h>
 #include <limits.h>
 
+#ifndef __APPLE__
 #include <linux/types.h>
 #include <linux/pkt_sched.h>
+#else
+#define NETEM_DIST_SCALE        8192
+#endif
 
 #define TABLESIZE 16384
 #define TABLEFACTOR NETEM_DIST_SCALE
Index: iproute2-2.6.15-060110/netem/pareto.c
===================================================================
--- iproute2-2.6.15-060110.orig/netem/pareto.c	2007-06-04 13:22:33.349785344 +0200
+++ iproute2-2.6.15-060110/netem/pareto.c	2007-06-04 13:22:34.476614040 +0200
@@ -7,8 +7,12 @@
 #include <math.h>
 #include <limits.h>
 
+#ifndef __APPLE__
 #include <linux/types.h>
 #include <linux/pkt_sched.h>
+#else
+#define NETEM_DIST_SCALE        8192
+#endif
 
 static const double a=3.0;
 #define TABLESIZE	16384
Index: iproute2-2.6.15-060110/netem/paretonormal.c
===================================================================
--- iproute2-2.6.15-060110.orig/netem/paretonormal.c	2007-06-04 13:22:33.356784280 +0200
+++ iproute2-2.6.15-060110/netem/paretonormal.c	2007-06-04 13:22:34.476614040 +0200
@@ -15,10 +15,13 @@
 #include <string.h>
 #include <math.h>
 #include <limits.h>
+#ifndef __APPLE__
 #include <malloc.h>
-
 #include <linux/types.h>
 #include <linux/pkt_sched.h>
+#else
+#define NETEM_DIST_SCALE        8192
+#endif
 
 #define TABLESIZE	16384
 #define TABLEFACTOR	NETEM_DIST_SCALE
