--- a/xtables.c
+++ b/xtables.c
@@ -285,6 +285,7 @@ void *xtables_realloc(void *ptr, size_t 
 
 static char *get_modprobe(void)
 {
+#ifndef FORCE_MODPROBE_PROGRAM
 	int procfile;
 	char *ret;
 
@@ -309,6 +310,9 @@ static char *get_modprobe(void)
 	free(ret);
 	close(procfile);
 	return NULL;
+#else
+	return strdup(FORCE_MODPROBE_PROGRAM);
+#endif
 }
 
 int xtables_insmod(const char *modname, const char *modprobe, bool quiet)
