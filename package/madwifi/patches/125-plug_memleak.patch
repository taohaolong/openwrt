Index: madwifi-ng-r2525-20070630/net80211/ieee80211_input.c
===================================================================
--- madwifi-ng-r2525-20070630.orig/net80211/ieee80211_input.c	2007-07-03 23:02:31.005981500 +0200
+++ madwifi-ng-r2525-20070630/net80211/ieee80211_input.c	2007-07-03 23:02:31.926039000 +0200
@@ -2873,7 +2873,7 @@
 			ieee80211_add_scan(vap, &scan, wh, subtype, rssi, rtsf);
 			return;
 		}
-		if (scan.capinfo & IEEE80211_CAPINFO_IBSS) {
+		if ((vap->iv_opmode == IEEE80211_M_IBSS) && (scan.capinfo & IEEE80211_CAPINFO_IBSS)) {
 			if (!IEEE80211_ADDR_EQ(wh->i_addr2, ni->ni_macaddr)) {
 				/* Create a new entry in the neighbor table. */
 				ni = ieee80211_add_neighbor(vap, wh, &scan);
